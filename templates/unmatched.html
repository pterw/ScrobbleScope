{% extends 'base.html' %}

{% block title %}Unmatched Albums | ScrobbleScope{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/unmatched.css') }}">
{% endblock %}

{% block content %}
    <div class="container mt-5 mb-5">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="col-md-8 text-center mx-auto mb-4" id="logo-wrapper">
                    <div aria-label="ScrobbleScope logo visualization" role="img">
                        {% include 'inline/scrobble_scope_inline.svg' ignore missing %}
                    </div>
                </div>

                <h1 class="text-center mb-4">Albums That Didn't Match Your Filter</h1>

                <div class="action-buttons">
                    <button onclick="window.history.back()" class="btn btn-primary">Back to Results</button>
                    <a href="/" class="btn btn-outline-secondary ms-2">New Search</a>
                </div>

                <div class="card shadow-sm fade-in">
                    <div class="card-body">
                        <div class="info-card">
                            <h5>Filter Information</h5>
                            <p>These albums were found in your {{ year }} listening history but didn't match your filter criteria:</p>
                            <ul>
                                <li><strong>Username:</strong> {{ username }}</li>
                                <li><strong>Listening Year:</strong> {{ year }}</li>
                                <li><strong>Filter:</strong> Albums from {{ filter_desc }}</li>
                                <li><strong>Album Thresholds:</strong> Minimum {{ min_plays }} plays and {{ min_tracks }} unique tracks</li>
                            </ul>
                            <p>Total albums that didn't match: <strong>{{ total_count }}</strong></p>
                        </div>

                        {% for reason, albums in reasons.items() %}
                        <div class="reason-section">
                            <div class="reason-header">
                                {{ reason }} <span class="reason-count">{{ reason_counts[reason] }}</span>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover mb-0">
                                    <thead class="table-dark">
                                        <tr>
                                            <th width="60">#</th>
                                            <th>Artist</th>
                                            <th>Album</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for album in albums %}
                                        <tr>
                                            <td>{{ loop.index }}</td>
                                            <td>{{ album.artist }}</td>
                                            <td>{{ album.album }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/unmatched.js') }}"></script>
{% endblock %}
